unzip 2018-11-13-raspbian-stretch-lite.zip
sudo dd if=2018-11-13-raspbian-stretch-lite.img of=/dev/sdd bs=4M
sync
mount /dev/sdd1 /someplace
touch /someplace/ssh; sync
umount /dev/sdd1

# Logged onto Pi

sudo apt update --fix-missing && sudo apt upgrade -y

sudo raspi-config
	update
    boot options -> desktop/cli -> console
	localization -> change locale -> only enable (C&en_US ones, default en_US.UTF-8)
	localization -> change timezone -> US -> Central
	localization -> change wifi country -> US
	interfacing options -> ssh -> yes 
	interfacing options -> serial -> no -> yes

sudo reboot

sudo apt install -y python3-pip git libblas3 libgfortran3 liblapack3 libatlas3-base ntp ntpdate ntpstat hostapd dnsmasq vim


# Copy piside code
# Copy pi to ~/configs

# in server folder
sudo pip3 install --upgrade -r requirements.txt 

# udev teensy files for controller
sudo cp 49-teensy.rules /etc/udev/rules.d

# Change password
passwd



#Copy autohotspot to /usr/bin

#ROOT CRON
*/2 * * * * /root/autohotspotcron


#Put in /root/autohotspotcron
#!/bin/sh
/usr/bin/autohotspot


#Edit dnsmasq
bogus-priv
interface=wlan0
dhcp-range=192.168.45.11,192.168.45.50,255.255.255.0,12h

log-facility=/var/log/dnsmasq.log
log-async
log-dhcp


cp autohotspot /usr/bin/autohotspot
cp networkstartup.sh /root/
ln -s /ssteq/piside/server/ctrl_dnsmasq.py /root/ctrl_dnsmasq.py


#Append to dhcpcd.conf
interface wlan0
static ip_address=192.168.45.1/24
denyinterfaces eth0
denyinterfaces wlan0



/etc/dhcp/dhclient.conf
  timeout 15


systemctl disable ntp-client.service
systemctl disable apt-daily.service
systemctl disable apt-daily-upgrade.service
systemctl disable dnsmasq.service
systemctl disable hostapd.service
systemctl disable bluetooth.service

cp ssteq25.service /etc/systemd/system/
cp clearhomepyc.service /etc/systemd/system/
cp dnsmasq-eth0.service /etc/systemd/system/

cp dnsmasq.eth0.conf /etc
cp dnsmasq.eth0.sh /root
cp interfaces.default /etc/network/interfaces.d/default
cp wpa_supplicant.conf /etc/wpa_supplicant/
cp hostapd.conf /etc/hostapd/
cp hostname /etc/
cp hosts /etc

systemctl enable dnsmasq-eth0.service
systemctl enable clearhomepyc.service 
systemctl enable ssteq25
systemctl enable autohotspot

# Edit cron
crontab -e
*/1 * * * * /usr/bin/autohotspot
*/1 * * * * /root/dnsmasq.eth0.sh


apt-get install astrometry.net imagemagick avahi-utils
# copy index-41* data to /usr/share/astrometry

