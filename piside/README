unzip 2018-11-13-raspbian-stretch-lite.zip
sudo dd if=2018-11-13-raspbian-stretch-lite.img of=/dev/sde bs=4M
sync

# Logged onto Pi

sudo apt update && sudo apt upgrade -y
sudo apt install -y ntp ntpdate ntpstat
sudo apt install -y hostapd dnsmasq

sudo raspi-config
	update
    boot options -> desktop/cli -> console
	localization -> change locale -> only enable (C&en_US ones, default en_US.UTF-8)
	localization -> change timezone -> US -> Central
	localization -> keyboard layout -> generic 104-key pc -> other -> English (US) -> English (US) -> The default -> no compose, No
	localization -> change wifi country -> US
	interfacing options -> camera -> yes
	interfacing options -> ssh -> yes 
	interfacing options -> serial -> no -> yes

sudo reboot

sudo apt install -y python3-pip git 
sudo apt install -y libblas-common libblas3 libgfortran3 liblapack3
apt install -y libatlas3-base



# Copy piside code

# in server folder
sudo pip3 install --upgrade -r requirements.txt 

# udev teensy files for controller
sudo cp 49-teensy.rules /etc/udev/rules.d

# Change password
passwd



# Setup ramtmp
sudo mkdir /ramtmp
#Edit /etc/fstab
tmpfs /ramtmp tmpfs defaults,noatime,nosuid,nodev,noexec,mode=1777,size=5M 0 0

sudo mount /ramtmp



#Copy autohotspot to /usr/bin

#ROOT CRON
*/2 * * * * /root/autohotspotcron


#Put in /root/autohotspotcron
#!/bin/sh
/usr/bin/autohotspot


#Edit dnsmasq
bogus-priv
interface=wlan0
dhcp-range=192.168.45.11,192.168.45.50,255.255.255.0,12h

log-facility=/var/log/dnsmasq.log
log-async
log-dhcp


#Add to rc.local

/usr/local/bin/supervisord -c /etc/supervisord.conf
/root/networkstartup.sh

cp autohotspot /usr/bin/autohotspot

#Put in /root/networkstartup.sh
#!/bin/sh
/root/ctrl_dnsmasq.py wlan0 disable
/root/ctrl_dnsmasq.py check_and_restart
sleep 5
/root/autohotspotcron




#Add to dhcpcd.conf
interface wlan0
static ip_address=192.168.45.1/24
denyinterfaces eth0
denyinterfaces wlan0


mkdir /ramtmp
mkdir /caltmp
chown pi /caltmp
in /etc/fstab
tmpfs /ramtmp tmpfs defaults,size=20m,mode=1777 0 0



ln -s /home/pi/SSTForkMountFirmware/piside/server/ctrl_dnsmasq.py /root/ctrl_dnsmasq.py

/etc/dhcp/dhclient.conf
  timeout 15


systemctl disable ntp-client.service
systemctl disable apt-daily.service
systemctl disable apt-daily-upgrade.service
systemctl disable dnsmasq.service
systemctl disable hostapd.service
systemctl disable bluetooth.service

cp ssteq25.service and autohotspot.service to /etc/systemd/system/

systemctl enable ssteq25
systemctl enable autohotspot

